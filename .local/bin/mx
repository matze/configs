#!/usr/bin/env sh
#
# mx
# version 0.3
#
# Original work by:
#   Wynn Netherland - http://github.com/pengwynn
#   Adam Jahnke - http://github.com/adamyonk

# Usage:
#   mx [session]

set -e

alias tmux="TERM=xterm-256color tmux"

if [ -z "$1" ]; then
    SESSION="${PWD##*/}"
else
    SESSION="$1"
fi

echo $SESSION

if ! (tmux has-session -t "$SESSION" >/dev/null 2>&1); then
    if [ -x "$PWD"/.tmux ]; then
        "$PWD"/.tmux "$SESSION"
    else
        case "$SESSION" in
            "blog")
                tmux new-session -s "$SESSION" -n edit -d
                tmux send-keys 'cd ~/blog' 'C-m'
                tmux new-window
                tmux rename-window preview
                tmux send-keys 'cd ~/blog' 'C-m'
                tmux send-keys 'make serve' 'C-m'
                tmux select-window -t 1
                ;;
            *)
                tmux new-session -s "$SESSION"
        esac
    fi
fi

if [ -z "$TMUX" ]; then
    tmux attach -t "$SESSION"
else
    tmux switch-client -t "$SESSION"
fi
