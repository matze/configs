#!/usr/bin/env python
# -*- coding: utf-8 -*-
import locale
from gi.repository import GWeather, GLib

locale.setlocale(locale.LC_ALL, '')


class App(object):
    def __init__(self):
        world = GWeather.Location.get_world()
        location = world.find_by_station_code('EDSB')
        self.loop = GLib.MainLoop.new(None, False)
        self.info = GWeather.Info.new(location, GWeather.ForecastType.LIST)
        self.info.connect('updated', self.show)

    def run(self):
        self.info.update()
        self.loop.run()

    def show(self, info):
        try:
            attribution = info.get_attribution()
            
            if attribution:
                print(attribution)

            data = dict(location=info.get_location_name(),
                        sky=info.get_sky(),
                        temp=info.get_temp(),
                        wind=info.get_wind())

            print("{location}: {temp} · {sky} · {wind}".format(**data))
        finally:
            self.loop.quit()


if __name__ == '__main__':
    app = App()
    app.run()
